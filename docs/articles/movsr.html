<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scraping Vehicle Stop Data • movsr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Scraping Vehicle Stop Data">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">movsr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/movsr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/analysis-2017-vehicle-stops.html">Analysis - 2017 Vehicle Stops</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/slu-openGIS/movsr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Scraping Vehicle Stop Data</h1>
                        <h4 class="author">Christopher Prener, Ph.D.</h4>
            
            <h4 class="date">2019-05-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/slu-openGIS/movsr/blob/master/vignettes/movsr.Rmd"><code>vignettes/movsr.Rmd</code></a></small>
      <div class="hidden name"><code>movsr.Rmd</code></div>

    </div>

    
    
<p>The <a href="https://ago.mo.gov/">Missouri Attorney General’s Office</a> publishes <a href="https://ago.mo.gov/home/vehicle-stops-report/">annual vehicle stop reports</a>. These include agency, county, and state level data on traffic stops conducted by police departments in Missouri, and can be used to track disparities in how these departments perform their duties. Unfortunately the data are not published in a machine readable format. Rather, they are published on tables embedded in the AG’s website. <code>movsr</code> provides functions for scraping these tables and reformatting their contents.</p>
<div id="install" class="section level2">
<h2 class="hasAnchor">
<a href="#install" class="anchor"></a>Install</h2>
<div id="installing-docker" class="section level3">
<h3 class="hasAnchor">
<a href="#installing-docker" class="anchor"></a>Installing Docker</h3>
<p>The web scraping tool used, <code>RSelenium</code>, performs best when Docker is used for headless browsing. Directions are provided on Docker’s website for both <a href="https://docs.docker.com/docker-for-mac/">macOS</a> and <a href="https://docs.docker.com/docker-for-windows/">Windows</a>.</p>
<p>Once Docker is installed, a headless browser needs to be pulled and set-up. The selenium project provides a number of options, but Firefox appears to be the best:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="ex">docker</span> pull selenium/standalone-firefox</a></code></pre></div>
</div>
<div id="installing-movsr" class="section level3">
<h3 class="hasAnchor">
<a href="#installing-movsr" class="anchor"></a>Installing <code>movsr</code>
</h3>
<p><code>movsr</code> can be accessed from GitHub with <code>remotes</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># install.packages("remotes")</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">remotes<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/remotes/topics/install_github">install_github</a></span>(<span class="st">"slu-openGIS/movsr"</span>)</a></code></pre></div>
</div>
<div id="other-tools" class="section level3">
<h3 class="hasAnchor">
<a href="#other-tools" class="anchor"></a>Other Tools</h3>
<p>In addition to Docker and <code>movsr</code>’s dependencies, users will find <code>purrr</code> useful for creating cross sectional data sets. If you have installed the <code>tideyverse</code>, it should already be installed in your <code>R</code> library. Otherwise:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"purrr"</span>)</a></code></pre></div>
</div>
</div>
<div id="web-scraping-with-docker-and-rselenium" class="section level2">
<h2 class="hasAnchor">
<a href="#web-scraping-with-docker-and-rselenium" class="anchor"></a>Web Scraping with Docker and RSelenium</h2>
<p>In order to download tables from the AG’s website, we use Docker as a “headless browser” to pull up the relevant pages (via <code>RSelenium</code>) on the website and then scrape them using <code>rvest</code> (this happens within the <code>movsr</code> functions).</p>
<div id="starting-a-headless-browser" class="section level3">
<h3 class="hasAnchor">
<a href="#starting-a-headless-browser" class="anchor"></a>Starting a Headless Browser</h3>
<p>Once Docker is installed and started, the following bash command can be used to get a headless browser running on macOS:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="ex">docker</span> run -d -p 4445:4444 selenium/standalone-firefox</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">#&gt; de177cf38f591f3728980fa9ca8acb504128fd9ecb9de6b45595d0b377e6b754</span></a></code></pre></div>
</div>
<div id="connecting-r-to-the-browser" class="section level3">
<h3 class="hasAnchor">
<a href="#connecting-r-to-the-browser" class="anchor"></a>Connecting <code>R</code> to the Browser</h3>
<p>With a headless browser running, the <code>RSelenium</code> package is used to connect to it. First, we need to load the <code>RSelenium</code> package:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(RSelenium)</a></code></pre></div>
<p>Next, we need to instruct <code>RSelenium</code> to connect to the port we’ve opened using Docker using the <code><a href="https://www.rdocumentation.org/packages/RSelenium/topics/remoteDriver-class">remoteDriver()</a></code> function:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">remDr &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/RSelenium/topics/remoteDriver-class">remoteDriver</a></span>(<span class="dt">port=</span>4445L, <span class="dt">browserName =</span> <span class="st">"firefox"</span>)</a></code></pre></div>
<p>Finally, we need to open that connection with <code>remDr$open()</code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">remDr<span class="op">$</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/connections">open</a></span>()</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt; [1] "Connecting to remote server"</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt; $acceptInsecureCerts</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt; $browserName</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt; [1] "firefox"</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt; $browserVersion</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt; [1] "66.0.3"</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt; $`moz:accessibilityChecks`</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt; $`moz:geckodriverVersion`</span></a>
<a class="sourceLine" id="cb7-16" data-line-number="16"><span class="co">#&gt; [1] "0.24.0"</span></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-18" data-line-number="18"><span class="co">#&gt; $`moz:headless`</span></a>
<a class="sourceLine" id="cb7-19" data-line-number="19"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb7-20" data-line-number="20"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-21" data-line-number="21"><span class="co">#&gt; $`moz:processID`</span></a>
<a class="sourceLine" id="cb7-22" data-line-number="22"><span class="co">#&gt; [1] 51</span></a>
<a class="sourceLine" id="cb7-23" data-line-number="23"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-24" data-line-number="24"><span class="co">#&gt; $`moz:profile`</span></a>
<a class="sourceLine" id="cb7-25" data-line-number="25"><span class="co">#&gt; [1] "/tmp/rust_mozprofile.Z0YA0KVLIC9G"</span></a>
<a class="sourceLine" id="cb7-26" data-line-number="26"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-27" data-line-number="27"><span class="co">#&gt; $`moz:shutdownTimeout`</span></a>
<a class="sourceLine" id="cb7-28" data-line-number="28"><span class="co">#&gt; [1] 60000</span></a>
<a class="sourceLine" id="cb7-29" data-line-number="29"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-30" data-line-number="30"><span class="co">#&gt; $`moz:useNonSpecCompliantPointerOrigin`</span></a>
<a class="sourceLine" id="cb7-31" data-line-number="31"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb7-32" data-line-number="32"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-33" data-line-number="33"><span class="co">#&gt; $`moz:webdriverClick`</span></a>
<a class="sourceLine" id="cb7-34" data-line-number="34"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb7-35" data-line-number="35"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-36" data-line-number="36"><span class="co">#&gt; $pageLoadStrategy</span></a>
<a class="sourceLine" id="cb7-37" data-line-number="37"><span class="co">#&gt; [1] "normal"</span></a>
<a class="sourceLine" id="cb7-38" data-line-number="38"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-39" data-line-number="39"><span class="co">#&gt; $platformName</span></a>
<a class="sourceLine" id="cb7-40" data-line-number="40"><span class="co">#&gt; [1] "linux"</span></a>
<a class="sourceLine" id="cb7-41" data-line-number="41"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-42" data-line-number="42"><span class="co">#&gt; $platformVersion</span></a>
<a class="sourceLine" id="cb7-43" data-line-number="43"><span class="co">#&gt; [1] "4.9.87-linuxkit-aufs"</span></a>
<a class="sourceLine" id="cb7-44" data-line-number="44"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-45" data-line-number="45"><span class="co">#&gt; $rotatable</span></a>
<a class="sourceLine" id="cb7-46" data-line-number="46"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb7-47" data-line-number="47"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-48" data-line-number="48"><span class="co">#&gt; $setWindowRect</span></a>
<a class="sourceLine" id="cb7-49" data-line-number="49"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb7-50" data-line-number="50"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-51" data-line-number="51"><span class="co">#&gt; $strictFileInteractability</span></a>
<a class="sourceLine" id="cb7-52" data-line-number="52"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb7-53" data-line-number="53"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-54" data-line-number="54"><span class="co">#&gt; $timeouts</span></a>
<a class="sourceLine" id="cb7-55" data-line-number="55"><span class="co">#&gt; $timeouts$implicit</span></a>
<a class="sourceLine" id="cb7-56" data-line-number="56"><span class="co">#&gt; [1] 0</span></a>
<a class="sourceLine" id="cb7-57" data-line-number="57"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-58" data-line-number="58"><span class="co">#&gt; $timeouts$pageLoad</span></a>
<a class="sourceLine" id="cb7-59" data-line-number="59"><span class="co">#&gt; [1] 300000</span></a>
<a class="sourceLine" id="cb7-60" data-line-number="60"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-61" data-line-number="61"><span class="co">#&gt; $timeouts$script</span></a>
<a class="sourceLine" id="cb7-62" data-line-number="62"><span class="co">#&gt; [1] 30000</span></a>
<a class="sourceLine" id="cb7-63" data-line-number="63"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-64" data-line-number="64"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-65" data-line-number="65"><span class="co">#&gt; $unhandledPromptBehavior</span></a>
<a class="sourceLine" id="cb7-66" data-line-number="66"><span class="co">#&gt; [1] "dismiss and notify"</span></a>
<a class="sourceLine" id="cb7-67" data-line-number="67"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-68" data-line-number="68"><span class="co">#&gt; $webdriver.remote.sessionid</span></a>
<a class="sourceLine" id="cb7-69" data-line-number="69"><span class="co">#&gt; [1] "9de4421f-9b2e-41cd-86c5-b26d23d00f0f"</span></a>
<a class="sourceLine" id="cb7-70" data-line-number="70"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-71" data-line-number="71"><span class="co">#&gt; $id</span></a>
<a class="sourceLine" id="cb7-72" data-line-number="72"><span class="co">#&gt; [1] "9de4421f-9b2e-41cd-86c5-b26d23d00f0f"</span></a></code></pre></div>
<p>For details on using <code>RSelenium</code> on other operating systems with Docker, see the <a href="https://ropensci.github.io/RSelenium/articles/docker.html">relevant vignette</a> on the <a href="https://ropensci.github.io/RSelenium/"><code>RSelenium</code> package website</a>.</p>
</div>
<div id="scraping-data" class="section level3">
<h3 class="hasAnchor">
<a href="#scraping-data" class="anchor"></a>Scraping Data</h3>
<p>With the connection open, we can begin scraping using <code>movsr</code> functions. For example, if we wanted to pull traffic stop counts for the City of St. Louis, we can use <code><a href="../reference/mv_get_agency.html">mv_get_agency()</a></code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co"># scrape table</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">slmpd_stops &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mv_get_agency.html">mv_get_agency</a></span>(<span class="dt">browser =</span> remDr, <span class="dt">agency =</span> <span class="dv">587</span>, <span class="dt">statistic =</span> <span class="st">"Stops"</span>, <span class="dt">pause =</span> <span class="dv">1</span>)</a></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(slmpd_stops)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co">#&gt; # A tibble: 6 x 4</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co">#&gt;   agency         cat   year  value</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co">#&gt;   &lt;chr&gt;          &lt;chr&gt; &lt;chr&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">#&gt; 1 St. Louis City Asian 2000    148</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">#&gt; 2 St. Louis City Asian 2001      0</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co">#&gt; 3 St. Louis City Asian 2002    441</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="co">#&gt; 4 St. Louis City Asian 2003    412</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="co">#&gt; 5 St. Louis City Asian 2004    254</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="co">#&gt; 6 St. Louis City Asian 2005    488</span></a></code></pre></div>
<p>The <code><a href="../reference/mv_get_agency.html">mv_get_agency()</a></code> function returns tidy data in “long” format. The <code>"Stops"</code> data returned are the number of stops conducted for each year by race. To convert these into proportions of the total number of stops, we can use <code><a href="../reference/mv_reformat.html">mv_reformat()</a></code></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co"># reformat table</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">slmpd_stops &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mv_reformat.html">mv_reformat</a></span>(slmpd_stops, <span class="dt">statistic =</span> <span class="st">"Stops"</span>, <span class="dt">format =</span> <span class="st">"prop"</span>)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co"># preview table</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(slmpd_stops)</a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt; # A tibble: 6 x 4</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt;   agency         year  cat     value</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt;   &lt;chr&gt;          &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt; 1 St. Louis City 2000  Asian 0.0130 </span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt; 2 St. Louis City 2001  Asian 0      </span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt; 3 St. Louis City 2002  Asian 0.0117 </span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt; 4 St. Louis City 2003  Asian 0.0127 </span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt; 5 St. Louis City 2004  Asian 0.0106 </span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt; 6 St. Louis City 2005  Asian 0.00903</span></a></code></pre></div>
<p>Using proportions or percentage values gives us the proper context for understanding if 441 stops of Asian drivers in 2002 is a large or small number relative to the total number of stops made that year.</p>
</div>
</div>
<div id="plotting-data" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-data" class="anchor"></a>Plotting Data</h2>
<p>With a data set of proportions created, we can plot the trends in traffic stops by race using <code>ggplot2</code>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co"># load dependencies</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(RColorBrewer)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4"></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="co"># create plot</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="dt">data =</span> slmpd_stops, <span class="dt">mapping =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(year), <span class="dt">y =</span> value, <span class="dt">color =</span> cat)) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>(<span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/scale_brewer">scale_colour_brewer</a></span>(<span class="dt">palette =</span> <span class="st">"Dark2"</span>, <span class="dt">name =</span> <span class="st">"Race"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/labs">labs</a></span>(</a>
<a class="sourceLine" id="cb11-10" data-line-number="10">    <span class="dt">title =</span> <span class="st">"Racial Breakdown of Traffic Stops"</span>,</a>
<a class="sourceLine" id="cb11-11" data-line-number="11">    <span class="dt">subtitle =</span> <span class="st">"St. Louis Metropolitan Police Department"</span>,</a>
<a class="sourceLine" id="cb11-12" data-line-number="12">    <span class="dt">x =</span> <span class="st">"Year"</span>,</a>
<a class="sourceLine" id="cb11-13" data-line-number="13">    <span class="dt">y =</span> <span class="st">"Proportion of Total Stops"</span>,</a>
<a class="sourceLine" id="cb11-14" data-line-number="14">    <span class="dt">caption =</span> <span class="st">"Plot by Christopher Prener, Ph.D.</span><span class="ch">\n</span><span class="st">Data via the Missouri Attorney General's Office"</span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15">  )</a></code></pre></div>
<p><img src="movsr_files/figure-html/plot-slmpd-1.png" width="700"></p>
</div>
<div id="creating-cross-sectional-data-sets" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-cross-sectional-data-sets" class="anchor"></a>Creating Cross Sectional Data Sets</h2>
<p>If you want to create a cross-sectional data set, use the <code><a href="../reference/mv_batch_agency.html">mv_batch_agency()</a></code> function to scrape, reformat, and subset all in one call. This can be fed to the <code>purrr</code> package’s <code><a href="https://purrr.tidyverse.org/reference/map.html">map_df()</a></code> function along with a vector of police department identification numbers. These numbers can be obtained from the individual agency pages on the <a href="https://ago.mo.gov/home/vehicle-stops-report/">annual vehicle stop reports</a>.</p>
<p>The number at the end of the URL is the identification number. For example, the URL for the Jefferson City Police Department is:</p>
<pre><code>https://ago.mo.gov/home/vehicle-stops-report?lea=266</code></pre>
<p>The identification number would therefore be 266. If we wanted to download disparity data for Cole County (home of the state capital, Jefferson City), we would need create a vector with the relevant identification numbers:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">coleCounty &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">88</span>, <span class="dv">266</span>)</a></code></pre></div>
<p>Only the Cole County Sheriff’s Department and the Jefferson City Police Department reported stops in 2017, and so we’ll limit our vector to those departments.</p>
<p>Next, we create our pipeline with <code>purrr</code> and <code>dplyr</code> functions:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co"># load dependencies</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(purrr)</a>
<a class="sourceLine" id="cb14-4" data-line-number="4"></a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="co"># create cross-sectional data set</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6">coleCounty <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span>(<span class="op">~</span><span class="st"> </span><span class="kw"><a href="../reference/mv_batch_agency.html">mv_batch_agency</a></span>(<span class="dt">browser =</span> remDr, <span class="dt">agency =</span> .x, <span class="dt">statistic =</span> <span class="st">"Disparity"</span>, <span class="dt">format =</span> <span class="st">"index"</span>,</a>
<a class="sourceLine" id="cb14-8" data-line-number="8">                           <span class="dt">category =</span> <span class="st">"Black"</span>, <span class="dt">year =</span> <span class="dv">2017</span>, <span class="dt">pause =</span> <span class="dv">1</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="dt">disp =</span> value) -&gt;<span class="st"> </span>coleCountyDisp</a></code></pre></div>
<p>A full example of this workflow, including combining multiple measures into a single data set, can be found at the bottom of the <a href="articles/analysis-2017-vehicle-stops.html">2017 vehicle stops analysis article</a>.</p>
</div>
<div id="closing-down-our-session" class="section level2">
<h2 class="hasAnchor">
<a href="#closing-down-our-session" class="anchor"></a>Closing Down Our Session</h2>
<p>Once we are done scraping, we can shut down our session:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="ex">docker</span> stop <span class="va">$(</span><span class="ex">docker</span> ps -a -q<span class="va">)</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="co">#&gt; de177cf38f59</span></a></code></pre></div>
<p>This will shut down <em>all</em> Docker sessions, so if you are using other Docker tools, be forewarned!</p>
<p>Finally, we’ll the delete the Docker image our session created to preserve space on our hard drive:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="ex">docker</span> rm <span class="va">$(</span><span class="ex">docker</span> ps -a -q<span class="va">)</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="co">#&gt; de177cf38f59</span></a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#install">Install</a></li>
      <li><a href="#web-scraping-with-docker-and-rselenium">Web Scraping with Docker and RSelenium</a></li>
      <li><a href="#plotting-data">Plotting Data</a></li>
      <li><a href="#creating-cross-sectional-data-sets">Creating Cross Sectional Data Sets</a></li>
      <li><a href="#closing-down-our-session">Closing Down Our Session</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://chris-prener.github.io">Christopher Prener</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
